const oracledb = require('oracledb');

const config = {
    user: 'system',
    password: 'senha',
    connectString: 'oracle-db:1521/FREEPDB1'
};

async function waitForOracleDB(maxRetries = 20, delay = 5000) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const connection = await oracledb.getConnection(config);
      await connection.close();
      console.log("✅ Oracle DB is ready!");
      return;
    } catch (err) {
      console.log(`⏳ DB not ready (${i + 1}/${maxRetries}): ${err.message}`);
      await new Promise(res => setTimeout(res, delay));
    }
  }
  throw new Error("❌ Database not ready after max retries.");
}

module.exports = waitForOracleDB;
